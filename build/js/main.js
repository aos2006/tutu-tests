'use strict';

var getOnlyBrackets = str => {
  var regexp = /[^()\[\]{},<>]/g;
  return str.replace(regexp, "");
};
var areBracketsInOrder = str => {
  let brackets = new Map([[']', '['], ['}', '{'], [')', '('], ['>', '<']]);
  let isClean = true;
  const iter = (i, len, isCleaning, brackets, cur, acc) => {
    if (i >= len && !isCleaning) return isCleaning && !acc.length;
    if (i >= len) return isCleaning && !acc.length;
    if (brackets.has(cur[i])) {
      let isCleaning = acc.pop() === brackets.get(cur[i]);
      return iter(++i, len, isCleaning, brackets, cur, acc);
    } else {
      acc.push(str[i]);
      return iter(++i, len, isCleaning, brackets, cur, acc);
    }
  };
  return iter(0, str.length, isClean, brackets, str, []);
};
var checkSyntax = str => {
  const newStr = getOnlyBrackets(str);
  return areBracketsInOrder(newStr) ? 0 : 1;
};
console.log('checkSyntax');
console.log(checkSyntax("---((((((()))))))----") === 0);
console.log(checkSyntax("") === 0);
console.log(checkSyntax("before ( middle []) after ") === 0);
console.log(checkSyntax(") (") === 1);
console.log(checkSyntax("} {") === 1);
console.log(checkSyntax("<>(])") === 1);
console.log(checkSyntax("(  [  <>  ()  ]  <>  )") === 0);
console.log(checkSyntax("   (      [)") === 1);
'use strict';

let dsCount = (...args) => {
  const [str, ...rest] = args;
  const concatedSubstings = rest.join('');
  const iter = (count, position, curr, substring) => {
    if (curr.indexOf(substring, position) === -1) return count;

    let newPosition = curr.indexOf(substring, position);
    return iter(++count, ++newPosition, curr, substring);
  };

  return iter(0, 0, str.toLowerCase(), concatedSubstings.toLowerCase());
};
console.log('dsCount');
try {
  test(dsCount, ['ab___ab__', 'a', 'b'], 2);
  test(dsCount, ['___cd____', 'c', 'd'], 1);
  test(dsCount, ['de_______', 'd', 'e'], 1);
  test(dsCount, ['12_12__12', '1', '2'], 3);
  test(dsCount, ['_ba______', 'a', 'b'], 0);
  test(dsCount, ['_a__b____', 'a', 'b'], 0);
  test(dsCount, ['-ab-аb-ab', 'a', 'b'], 2);
  test(dsCount, ['aAa', 'a', 'a'], 2);
  console.info("Congratulations! All tests success passed.");
} catch (e) {
  console.error(e);
}

// Простая функция тестирования

function test(call, args, count, n) {
  let r = call.apply(n, args) === count;
  console.assert(r, `Finded items count: ${count}`);
  if (!r) throw "Test failed!";
}
console.log('parseUrl');
let parseUrl = url => {
  let a = document.createElement('a');
  a.href = url;
  return a;
};

let a = parseUrl('http://tutu.ru:8080/do/any.php?a=1&b[]=a&b[]=b#foo');

console.log(a.href);
console.log(a.hash);
console.log(a.port);
console.log(a.host);
console.log(a.protocol);
console.log(a.hostname);
console.log(a.pathname);
console.log(a.origin);
//Задача #1
const getSubstring = ({ str, subStr1, subStr2 }) => {
  if (str === '') return -1;
  let subStrPosition1 = str.lastIndexOf(subStr1, str.length - 1);
  let subStrPosition2 = str.lastIndexOf(subStr2, str.length - 1);

  return subStrPosition1 !== -1 ? subStrPosition1 : subStrPosition2 !== -1 ? subStrPosition2 : subStrPosition1 === subStrPosition2 ? subStrPosition1 : -1;
};

function func(s, a, b) {

  if (s.match(/^$/)) {
    return -1;
  }

  var i = s.length - 1;
  var aIndex = -1;
  var bIndex = -1;

  while (aIndex == -1 && bIndex == -1 && i > 0) {
    if (s.substring(i, i + 1) == a) {
      aIndex = i;
    }
    if (s.substring(i, i + 1) == b) {
      bIndex = i;
    }
    i = i - 1;
  }
  if (aIndex != -1) {
    if (bIndex == -1) {
      return aIndex;
    } else {
      return Math.max(aIndex, bIndex);
    }
  }

  if (bIndex != -1) {
    return bIndex;
  } else {
    return -1;
  }
}

console.log('Refactoring task 1', func('12345560', '0', '0'), getSubstring({ str: '12345560', subStr1: '0', subStr2: '0' }));

//Задача 2
const drawRating = vote => {
  return Math.ceil(vote / 20) > 0 ? Math.ceil(vote / 20) : 1;
};

// Проверка работы результата
console.log(drawRating(0));
console.log(drawRating(1));
console.log(drawRating(50));
console.log(drawRating(99));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrU3ludGF4LmpzIiwiZHNDb3VudC5qcyIsInBhcnNlVXJsLmpzIiwicmVmYWN0b3JpbmcuanMiXSwibmFtZXMiOlsiZ2V0T25seUJyYWNrZXRzIiwic3RyIiwicmVnZXhwIiwicmVwbGFjZSIsImFyZUJyYWNrZXRzSW5PcmRlciIsImJyYWNrZXRzIiwiTWFwIiwiaXNDbGVhbiIsIml0ZXIiLCJpIiwibGVuIiwiaXNDbGVhbmluZyIsImN1ciIsImFjYyIsImxlbmd0aCIsImhhcyIsInBvcCIsImdldCIsInB1c2giLCJjaGVja1N5bnRheCIsIm5ld1N0ciIsImNvbnNvbGUiLCJsb2ciLCJkc0NvdW50IiwiYXJncyIsInJlc3QiLCJjb25jYXRlZFN1YnN0aW5ncyIsImpvaW4iLCJjb3VudCIsInBvc2l0aW9uIiwiY3VyciIsInN1YnN0cmluZyIsImluZGV4T2YiLCJuZXdQb3NpdGlvbiIsInRvTG93ZXJDYXNlIiwidGVzdCIsImluZm8iLCJlIiwiZXJyb3IiLCJjYWxsIiwibiIsInIiLCJhcHBseSIsImFzc2VydCIsInBhcnNlVXJsIiwidXJsIiwiYSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImhyZWYiLCJoYXNoIiwicG9ydCIsImhvc3QiLCJwcm90b2NvbCIsImhvc3RuYW1lIiwicGF0aG5hbWUiLCJvcmlnaW4iLCJnZXRTdWJzdHJpbmciLCJzdWJTdHIxIiwic3ViU3RyMiIsInN1YlN0clBvc2l0aW9uMSIsImxhc3RJbmRleE9mIiwic3ViU3RyUG9zaXRpb24yIiwiZnVuYyIsInMiLCJiIiwibWF0Y2giLCJhSW5kZXgiLCJiSW5kZXgiLCJNYXRoIiwibWF4IiwiZHJhd1JhdGluZyIsInZvdGUiLCJjZWlsIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxrQkFBbUJDLEdBQUQsSUFBUztBQUM3QixNQUFJQyxTQUFTLGlCQUFiO0FBQ0EsU0FBUUQsR0FBRCxDQUFNRSxPQUFOLENBQWNELE1BQWQsRUFBc0IsRUFBdEIsQ0FBUDtBQUNE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LE1BQWpCLENBQVA7QUFDRDtBQUNGOztBQUVELE1BQUlBLFVBQVUsQ0FBQyxDQUFmLEVBQWtCO0FBQ2hCLFdBQU9BLE1BQVA7QUFDRCxHQUZELE1BR0s7QUFDSCxXQUFPLENBQUMsQ0FBUjtBQUNEO0FBQ0Y7O0FBRUQvQyxRQUFRQyxHQUFSLENBQ0ksb0JBREosRUFFSXlDLEtBQUssVUFBTCxFQUFpQixHQUFqQixFQUFzQixHQUF0QixDQUZKLEVBRWdDTixhQUFhLEVBQUN4RCxLQUFLLFVBQU4sRUFBa0J5RCxTQUFTLEdBQTNCLEVBQWdDQyxTQUFTLEdBQXpDLEVBQWIsQ0FGaEM7O0FBTUE7QUFDQSxNQUFNWSxhQUFjQyxJQUFELElBQVU7QUFDM0IsU0FBT0gsS0FBS0ksSUFBTCxDQUFVRCxPQUFPLEVBQWpCLElBQXVCLENBQXZCLEdBQTJCSCxLQUFLSSxJQUFMLENBQVVELE9BQUssRUFBZixDQUEzQixHQUFnRCxDQUF2RDtBQUNELENBRkQ7O0FBSUE7QUFDQW5ELFFBQVFDLEdBQVIsQ0FBWWlELFdBQVcsQ0FBWCxDQUFaO0FBQ0FsRCxRQUFRQyxHQUFSLENBQVlpRCxXQUFXLENBQVgsQ0FBWjtBQUNBbEQsUUFBUUMsR0FBUixDQUFZaUQsV0FBVyxFQUFYLENBQVo7QUFDQWxELFFBQVFDLEdBQVIsQ0FBWWlELFdBQVcsRUFBWCxDQUFaIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgZ2V0T25seUJyYWNrZXRzID0gKHN0cikgPT4ge1xuICB2YXIgcmVnZXhwID0gL1teKClcXFtcXF17fSw8Pl0vZztcbiAgcmV0dXJuIChzdHIpLnJlcGxhY2UocmVnZXhwLCBcIlwiKTtcbn07XG52YXIgYXJlQnJhY2tldHNJbk9yZGVyID0gKHN0cikgPT4ge1xuICBsZXQgYnJhY2tldHMgPSBuZXcgTWFwKFxuICAgICAgW1xuICAgICAgICAgIFsnXScsICdbJ10sXG4gICAgICAgICAgWyd9JywgJ3snXSxcbiAgICAgICAgICBbJyknLCAnKCddLFxuICAgICAgICAgIFsnPicsICc8J11cbiAgICAgIF1cbiAgKTtcbiAgbGV0IGlzQ2xlYW4gPSB0cnVlO1xuICBjb25zdCBpdGVyID0gKGksIGxlbiwgaXNDbGVhbmluZywgYnJhY2tldHMsIGN1ciwgYWNjKSA9PiB7XG4gICAgaWYgKGkgPj0gbGVuICYmICFpc0NsZWFuaW5nKSByZXR1cm4gaXNDbGVhbmluZyAmJiAhYWNjLmxlbmd0aDtcbiAgICBpZiAoaSA+PSBsZW4pIHJldHVybiBpc0NsZWFuaW5nICYmICFhY2MubGVuZ3RoO1xuICAgIGlmIChicmFja2V0cy5oYXMoY3VyW2ldKSkge1xuICAgICAgbGV0IGlzQ2xlYW5pbmcgPSBhY2MucG9wKCkgPT09IGJyYWNrZXRzLmdldChjdXJbaV0pO1xuICAgICAgcmV0dXJuIGl0ZXIoKytpLCBsZW4sIGlzQ2xlYW5pbmcsIGJyYWNrZXRzLCBjdXIsIGFjYyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjYy5wdXNoKHN0cltpXSk7XG4gICAgICByZXR1cm4gaXRlcigrK2ksIGxlbiwgaXNDbGVhbmluZywgYnJhY2tldHMsIGN1ciwgYWNjKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGl0ZXIoMCwgc3RyLmxlbmd0aCwgaXNDbGVhbiwgYnJhY2tldHMsIHN0ciwgW10pXG59O1xudmFyIGNoZWNrU3ludGF4ID0gKHN0cikgPT4ge1xuICBjb25zdCBuZXdTdHIgPSBnZXRPbmx5QnJhY2tldHMoc3RyKTtcbiAgcmV0dXJuIGFyZUJyYWNrZXRzSW5PcmRlcihuZXdTdHIpID8gMCA6IDE7XG59O1xuY29uc29sZS5sb2coJ2NoZWNrU3ludGF4JylcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheChcIi0tLSgoKCgoKCgpKSkpKSkpLS0tLVwiKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiXCIpID09PSAwKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCJiZWZvcmUgKCBtaWRkbGUgW10pIGFmdGVyIFwiKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiKSAoXCIpID09PSAxKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCJ9IHtcIikgPT09IDEpO1xuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIjw+KF0pXCIpID09PSAxKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCIoICBbICA8PiAgKCkgIF0gIDw+ICApXCIpID09PSAwKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCIgICAoICAgICAgWylcIikgPT09IDEpO1xuXG4iLCIndXNlIHN0cmljdCc7XG5sZXQgZHNDb3VudCA9ICguLi5hcmdzKSA9PiB7XG4gIGNvbnN0IFtzdHIsIC4uLnJlc3RdID0gYXJncztcbiAgY29uc3QgY29uY2F0ZWRTdWJzdGluZ3MgPSByZXN0LmpvaW4oJycpO1xuICBjb25zdCBpdGVyID0gKGNvdW50LCBwb3NpdGlvbiwgY3Vyciwgc3Vic3RyaW5nKSA9PiB7XG4gICAgICBpZihjdXJyLmluZGV4T2Yoc3Vic3RyaW5nLCBwb3NpdGlvbikgPT09IC0xKSByZXR1cm4gY291bnQ7XG5cbiAgICAgIGxldCBuZXdQb3NpdGlvbiA9IGN1cnIuaW5kZXhPZihzdWJzdHJpbmcsIHBvc2l0aW9uKTtcbiAgICAgIHJldHVybiBpdGVyKCsrY291bnQsICsrbmV3UG9zaXRpb24sIGN1cnIsIHN1YnN0cmluZyk7XG4gIH1cblxuICByZXR1cm4gaXRlcigwLCAwLCBzdHIudG9Mb3dlckNhc2UoKSwgY29uY2F0ZWRTdWJzdGluZ3MudG9Mb3dlckNhc2UoKSlcblxuXG59XG5jb25zb2xlLmxvZygnZHNDb3VudCcpO1xudHJ5IHtcbiAgdGVzdChkc0NvdW50LCBbJ2FiX19fYWJfXycsICdhJywgJ2InXSwgMik7XG4gIHRlc3QoZHNDb3VudCwgWydfX19jZF9fX18nLCAnYycsICdkJ10sIDEpO1xuICB0ZXN0KGRzQ291bnQsIFsnZGVfX19fX19fJywgJ2QnLCAnZSddLCAxKTtcbiAgdGVzdChkc0NvdW50LCBbJzEyXzEyX18xMicsICcxJywgJzInXSwgMyk7XG4gIHRlc3QoZHNDb3VudCwgWydfYmFfX19fX18nLCAnYScsICdiJ10sIDApO1xuICB0ZXN0KGRzQ291bnQsIFsnX2FfX2JfX19fJywgJ2EnLCAnYiddLCAwKTtcbiAgdGVzdChkc0NvdW50LCBbJy1hYi3QsGItYWInLCAnYScsICdiJ10sIDIpO1xuICB0ZXN0KGRzQ291bnQsIFsnYUFhJywgJ2EnLCAnYSddLCAyKTtcbiAgY29uc29sZS5pbmZvKFwiQ29uZ3JhdHVsYXRpb25zISBBbGwgdGVzdHMgc3VjY2VzcyBwYXNzZWQuXCIpO1xufSBjYXRjaChlKSB7XG4gIGNvbnNvbGUuZXJyb3IoZSk7XG59XG5cbi8vINCf0YDQvtGB0YLQsNGPINGE0YPQvdC60YbQuNGPINGC0LXRgdGC0LjRgNC+0LLQsNC90LjRj1xuXG5mdW5jdGlvbiB0ZXN0KGNhbGwsIGFyZ3MsIGNvdW50LCBuKSB7XG4gIGxldCByID0gKGNhbGwuYXBwbHkobiwgYXJncykgPT09IGNvdW50KTtcbiAgY29uc29sZS5hc3NlcnQociwgYEZpbmRlZCBpdGVtcyBjb3VudDogJHtjb3VudH1gKTtcbiAgaWYgKCFyKSB0aHJvdyBcIlRlc3QgZmFpbGVkIVwiO1xufVxuXG4iLCJjb25zb2xlLmxvZygncGFyc2VVcmwnKTtcbmxldCBwYXJzZVVybCA9ICh1cmwpID0+IHtcbiAgbGV0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICgnYScpO1xuICBhLmhyZWYgPSB1cmw7XG4gIHJldHVybiBhO1xufVxuXG5sZXQgYSA9IHBhcnNlVXJsKCdodHRwOi8vdHV0dS5ydTo4MDgwL2RvL2FueS5waHA/YT0xJmJbXT1hJmJbXT1iI2ZvbycpO1xuXG5jb25zb2xlLmxvZyhhLmhyZWYpO1xuY29uc29sZS5sb2coYS5oYXNoKTtcbmNvbnNvbGUubG9nKGEucG9ydCk7XG5jb25zb2xlLmxvZyhhLmhvc3QpO1xuY29uc29sZS5sb2coYS5wcm90b2NvbCk7XG5jb25zb2xlLmxvZyhhLmhvc3RuYW1lKTtcbmNvbnNvbGUubG9nKGEucGF0aG5hbWUpO1xuY29uc29sZS5sb2coYS5vcmlnaW4pO1xuIiwiLy/Ql9Cw0LTQsNGH0LAgIzFcbmNvbnN0IGdldFN1YnN0cmluZyA9ICh7c3RyLCBzdWJTdHIxLCBzdWJTdHIyfSkgPT4ge1xuICBpZiAoc3RyID09PSAnJykgcmV0dXJuIC0xO1xuICBsZXQgc3ViU3RyUG9zaXRpb24xID0gc3RyLmxhc3RJbmRleE9mKHN1YlN0cjEsIHN0ci5sZW5ndGggLSAxKTtcbiAgbGV0IHN1YlN0clBvc2l0aW9uMiA9IHN0ci5sYXN0SW5kZXhPZihzdWJTdHIyLCBzdHIubGVuZ3RoIC0gMSk7XG5cbiAgcmV0dXJuIHN1YlN0clBvc2l0aW9uMSAhPT0gLTEgPyBzdWJTdHJQb3NpdGlvbjEgOlxuICAgICAgICAgc3ViU3RyUG9zaXRpb24yICE9PSAtMSA/IHN1YlN0clBvc2l0aW9uMiA6XG4gICAgICAgICBzdWJTdHJQb3NpdGlvbjEgPT09IHN1YlN0clBvc2l0aW9uMiA/IHN1YlN0clBvc2l0aW9uMSA6IC0xO1xuXG59XG5cbmZ1bmN0aW9uIGZ1bmMocywgYSwgYikge1xuXG4gIGlmIChzLm1hdGNoKC9eJC8pKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgdmFyIGkgPSBzLmxlbmd0aCAtMTtcbiAgdmFyIGFJbmRleCA9ICAgICAtMTtcbiAgdmFyIGJJbmRleCA9ICAgICAtMTtcblxuICB3aGlsZSAoKGFJbmRleCA9PSAtMSkgJiYgKGJJbmRleCA9PSAtMSkgJiYgKGkgPiAwKSkge1xuICAgIGlmIChzLnN1YnN0cmluZyhpLCBpICsxKSA9PSBhKSB7XG4gICAgICBhSW5kZXggPSBpO1xuICAgIH1cbiAgICBpZiAocy5zdWJzdHJpbmcoaSwgaSArMSkgPT0gYikge1xuICAgICAgYkluZGV4ID0gaTtcbiAgICB9XG4gICAgaSA9IGkgLSAxO1xuICB9XG4gIGlmIChhSW5kZXggIT0gLTEpIHtcbiAgICBpZiAoYkluZGV4ID09IC0xKSB7XG4gICAgICByZXR1cm4gYUluZGV4O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBNYXRoLm1heChhSW5kZXgsIGJJbmRleCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGJJbmRleCAhPSAtMSkge1xuICAgIHJldHVybiBiSW5kZXg7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIC0xO1xuICB9XG59XG5cbmNvbnNvbGUubG9nKFxuICAgICdSZWZhY3RvcmluZyB0YXNrIDEnLFxuICAgIGZ1bmMoJzEyMzQ1NTYwJywgJzAnLCAnMCcpLCBnZXRTdWJzdHJpbmcoe3N0cjogJzEyMzQ1NTYwJywgc3ViU3RyMTogJzAnLCBzdWJTdHIyOiAnMCd9KVxuKVxuXG5cbi8v0JfQsNC00LDRh9CwIDJcbmNvbnN0IGRyYXdSYXRpbmcgPSAodm90ZSkgPT4ge1xuICByZXR1cm4gTWF0aC5jZWlsKHZvdGUgLyAyMCkgPiAwID8gTWF0aC5jZWlsKHZvdGUvMjApIDogMTtcbn1cblxuLy8g0J/RgNC+0LLQtdGA0LrQsCDRgNCw0LHQvtGC0Ysg0YDQtdC30YPQu9GM0YLQsNGC0LBcbmNvbnNvbGUubG9nKGRyYXdSYXRpbmcoMCkpO1xuY29uc29sZS5sb2coZHJhd1JhdGluZygxKSApO1xuY29uc29sZS5sb2coZHJhd1JhdGluZyg1MCkpO1xuY29uc29sZS5sb2coZHJhd1JhdGluZyg5OSkpOyJdfQ==
