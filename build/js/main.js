'use strict';

var getOnlyBrackets = str => {
  var regexp = /[^()\[\]{},<>]/g;
  return str.replace(regexp, "");
};
var areBracketsInOrder = str => {
  let brackets = new Map([[']', '['], ['}', '{'], [')', '('], ['>', '<']]);
  let isClean = true;
  const iter = (i, len, isCleaning, brackets, cur, acc) => {
    if (i >= len && !isCleaning) return isCleaning && !acc.length;
    if (i >= len) return isCleaning && !acc.length;
    if (brackets.has(cur[i])) {
      let isCleaning = acc.pop() === brackets.get(cur[i]);
      return iter(++i, len, isCleaning, brackets, cur, acc);
    } else {
      acc.push(str[i]);
      return iter(++i, len, isCleaning, brackets, cur, acc);
    }
  };
  return iter(0, str.length, isClean, brackets, str, []);
};
var checkSyntax = str => {
  const newStr = getOnlyBrackets(str);
  return areBracketsInOrder(newStr) ? 0 : 1;
};
console.log('checkSyntax');
console.log(checkSyntax("---((((((()))))))----") === 0);
console.log(checkSyntax("") === 0);
console.log(checkSyntax("before ( middle []) after ") === 0);
console.log(checkSyntax(") (") === 1);
console.log(checkSyntax("} {") === 1);
console.log(checkSyntax("<>(])") === 1);
console.log(checkSyntax("(  [  <>  ()  ]  <>  )") === 0);
console.log(checkSyntax("   (      [)") === 1);
'use strict';

let dsCount = (...args) => {
  const [str, ...rest] = args;
  const concatedSubstings = rest.join('');
  const iter = (count, position, curr, substring) => {
    if (curr.indexOf(substring, position) === -1) return count;

    let newPosition = curr.indexOf(substring, position);
    return iter(++count, ++newPosition, curr, substring);
  };

  return iter(0, 0, str.toLowerCase(), concatedSubstings.toLowerCase());
};
console.log('dsCount');
try {
  test(dsCount, ['ab___ab__', 'a', 'b'], 2);
  test(dsCount, ['___cd____', 'c', 'd'], 1);
  test(dsCount, ['de_______', 'd', 'e'], 1);
  test(dsCount, ['12_12__12', '1', '2'], 3);
  test(dsCount, ['_ba______', 'a', 'b'], 0);
  test(dsCount, ['_a__b____', 'a', 'b'], 0);
  test(dsCount, ['-ab-аb-ab', 'a', 'b'], 2);
  test(dsCount, ['aAa', 'a', 'a'], 2);
  console.info("Congratulations! All tests success passed.");
} catch (e) {
  console.error(e);
}

// Простая функция тестирования

function test(call, args, count, n) {
  let r = call.apply(n, args) === count;
  console.assert(r, `Finded items count: ${count}`);
  if (!r) throw "Test failed!";
}
//Задача #1
const getSubstring = ({ str, subStr1, subStr2 }) => {
  if (str === '') return -1;
  let subStrPosition1 = str.lastIndexOf(subStr1, str.length - 1);
  let subStrPosition2 = str.lastIndexOf(subStr2, str.length - 1);

  return subStrPosition1 !== -1 ? subStrPosition1 : subStrPosition2 !== -1 ? subStrPosition2 : subStrPosition1 === subStrPosition2 ? subStrPosition1 : -1;
};

function func(s, a, b) {

  if (s.match(/^$/)) {
    return -1;
  }

  var i = s.length - 1;
  var aIndex = -1;
  var bIndex = -1;

  while (aIndex == -1 && bIndex == -1 && i > 0) {
    if (s.substring(i, i + 1) == a) {
      aIndex = i;
    }
    if (s.substring(i, i + 1) == b) {
      bIndex = i;
    }
    i = i - 1;
  }
  if (aIndex != -1) {
    if (bIndex == -1) {
      return aIndex;
    } else {
      return Math.max(aIndex, bIndex);
    }
  }

  if (bIndex != -1) {
    return bIndex;
  } else {
    return -1;
  }
}

console.log('Refactoring task 1', func('12345560', '0', '0'), getSubstring({ str: '12345560', subStr1: '0', subStr2: '0' }));

//Задача 2
const drawRating = (vote, range = [0, 20], stars = '★☆☆☆☆') => {
  if (vote >= range[0] && vote <= range[1]) return stars;
  return new Error('Что то пошло не так, проверьте аргументы');
};

//function drawRating(vote) {
//  if (vote >= 0 && vote <= 20) {
//    return '★☆☆☆☆';
//  }
//  else if (vote > 20 && vote <= 40) {
//    return '★★☆☆☆';
//  }
//  else if (vote > 40 && vote <= 60) {
//    return '★★★☆☆';
//  }
//  else if (vote > 60 && vote <= 80) {
//    return '★★★★☆';
//  }
//  else if (vote > 80 && vote <= 100) {
//    return '★★★★★';
//  }
//}

// Проверка работы результата
console.log(drawRating(0, [0, 20], '★☆☆☆☆')); // ★☆☆☆☆
console.log(drawRating(1, [0, 20], '★☆☆☆☆')); // ★☆☆☆☆
console.log(drawRating(50, [40, 60], '★★★☆☆')); // ★★★☆☆
console.log(drawRating(99, [80, 100], '★★★★★')); // ★★★★★
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrU3ludGF4LmpzIiwiZHNDb3VudC5qcyIsInJlZmFjdG9yaW5nLmpzIl0sIm5hbWVzIjpbImdldE9ubHlCcmFja2V0cyIsInN0ciIsInJlZ2V4cCIsInJlcGxhY2UiLCJhcmVCcmFja2V0c0luT3JkZXIiLCJicmFja2V0cyIsIk1hcCIsImlzQ2xlYW4iLCJpdGVyIiwiaSIsImxlbiIsImlzQ2xlYW5pbmciLCJjdXIiLCJhY2MiLCJsZW5ndGgiLCJoYXMiLCJwb3AiLCJnZXQiLCJwdXNoIiwiY2hlY2tTeW50YXgiLCJuZXdTdHIiLCJjb25zb2xlIiwibG9nIiwiZHNDb3VudCIsImFyZ3MiLCJyZXN0IiwiY29uY2F0ZWRTdWJzdGluZ3MiLCJqb2luIiwiY291bnQiLCJwb3NpdGlvbiIsImN1cnIiLCJzdWJzdHJpbmciLCJpbmRleE9mIiwibmV3UG9zaXRpb24iLCJ0b0xvd2VyQ2FzZSIsInRlc3QiLCJpbmZvIiwiZSIsImVycm9yIiwiY2FsbCIsIm4iLCJyIiwiYXBwbHkiLCJhc3NlcnQiLCJnZXRTdWJzdHJpbmciLCJzdWJTdHIxIiwic3ViU3RyMiIsInN1YlN0clBvc2l0aW9uMSIsImxhc3RJbmRleE9mIiwic3ViU3RyUG9zaXRpb24yIiwiZnVuYyIsInMiLCJhIiwiYiIsIm1hdGNoIiwiYUluZGV4IiwiYkluZGV4IiwiTWF0aCIsIm1heCIsImRyYXdSYXRpbmciLCJ2b3RlIiwicmFuZ2UiLCJzdGFycyIsIkVycm9yIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxrQkFBbUJDLEdBQUQsSUFBUztBQUM3QixNQUFJQyxTQUFTLGlCQUFiO0FBQ0EsU0FBUUQsR0FBRCxDQUFNRSxPQUFOLENBQWNELE1BQWQsRUFBc0IsRUFBdEIsQ0FBUDtBQUNELENBSEQ7QUFJQSxJQUFJRSxxQkFBc0JILEdBQUQsSUFBUztBQUNoQyxNQUFJSSxXQUFXLElBQUlDLEdBQUosQ0FDWCxDQUNJLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FESixFQUVJLENBQUMsR0FB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LEdBQVIsQ0FBWXFDLFdBQVcsQ0FBWCxFQUFjLENBQUMsQ0FBRCxFQUFJLEVBQUosQ0FBZCxFQUF1QixPQUF2QixDQUFaLEdBQStDO0FBQy9DdEMsUUFBUUMsR0FBUixDQUFZcUMsV0FBVyxDQUFYLEVBQWMsQ0FBQyxDQUFELEVBQUksRUFBSixDQUFkLEVBQXVCLE9BQXZCLENBQVosR0FBK0M7QUFDL0N0QyxRQUFRQyxHQUFSLENBQVlxQyxXQUFXLEVBQVgsRUFBZSxDQUFDLEVBQUQsRUFBSyxFQUFMLENBQWYsRUFBeUIsT0FBekIsQ0FBWixHQUFnRDtBQUNoRHRDLFFBQVFDLEdBQVIsQ0FBWXFDLFdBQVcsRUFBWCxFQUFlLENBQUMsRUFBRCxFQUFLLEdBQUwsQ0FBZixFQUEwQixPQUExQixDQUFaLEdBQWlEIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgZ2V0T25seUJyYWNrZXRzID0gKHN0cikgPT4ge1xuICB2YXIgcmVnZXhwID0gL1teKClcXFtcXF17fSw8Pl0vZztcbiAgcmV0dXJuIChzdHIpLnJlcGxhY2UocmVnZXhwLCBcIlwiKTtcbn07XG52YXIgYXJlQnJhY2tldHNJbk9yZGVyID0gKHN0cikgPT4ge1xuICBsZXQgYnJhY2tldHMgPSBuZXcgTWFwKFxuICAgICAgW1xuICAgICAgICAgIFsnXScsICdbJ10sXG4gICAgICAgICAgWyd9JywgJ3snXSxcbiAgICAgICAgICBbJyknLCAnKCddLFxuICAgICAgICAgIFsnPicsICc8J11cbiAgICAgIF1cbiAgKTtcbiAgbGV0IGlzQ2xlYW4gPSB0cnVlO1xuICBjb25zdCBpdGVyID0gKGksIGxlbiwgaXNDbGVhbmluZywgYnJhY2tldHMsIGN1ciwgYWNjKSA9PiB7XG4gICAgaWYgKGkgPj0gbGVuICYmICFpc0NsZWFuaW5nKSByZXR1cm4gaXNDbGVhbmluZyAmJiAhYWNjLmxlbmd0aDtcbiAgICBpZiAoaSA+PSBsZW4pIHJldHVybiBpc0NsZWFuaW5nICYmICFhY2MubGVuZ3RoO1xuICAgIGlmIChicmFja2V0cy5oYXMoY3VyW2ldKSkge1xuICAgICAgbGV0IGlzQ2xlYW5pbmcgPSBhY2MucG9wKCkgPT09IGJyYWNrZXRzLmdldChjdXJbaV0pO1xuICAgICAgcmV0dXJuIGl0ZXIoKytpLCBsZW4sIGlzQ2xlYW5pbmcsIGJyYWNrZXRzLCBjdXIsIGFjYyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjYy5wdXNoKHN0cltpXSk7XG4gICAgICByZXR1cm4gaXRlcigrK2ksIGxlbiwgaXNDbGVhbmluZywgYnJhY2tldHMsIGN1ciwgYWNjKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGl0ZXIoMCwgc3RyLmxlbmd0aCwgaXNDbGVhbiwgYnJhY2tldHMsIHN0ciwgW10pXG59O1xudmFyIGNoZWNrU3ludGF4ID0gKHN0cikgPT4ge1xuICBjb25zdCBuZXdTdHIgPSBnZXRPbmx5QnJhY2tldHMoc3RyKTtcbiAgcmV0dXJuIGFyZUJyYWNrZXRzSW5PcmRlcihuZXdTdHIpID8gMCA6IDE7XG59O1xuY29uc29sZS5sb2coJ2NoZWNrU3ludGF4JylcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheChcIi0tLSgoKCgoKCgpKSkpKSkpLS0tLVwiKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiXCIpID09PSAwKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCJiZWZvcmUgKCBtaWRkbGUgW10pIGFmdGVyIFwiKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiKSAoXCIpID09PSAxKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCJ9IHtcIikgPT09IDEpO1xuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIjw+KF0pXCIpID09PSAxKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCIoICBbICA8PiAgKCkgIF0gIDw+ICApXCIpID09PSAwKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCIgICAoICAgICAgWylcIikgPT09IDEpO1xuXG4iLCIndXNlIHN0cmljdCc7XG5sZXQgZHNDb3VudCA9ICguLi5hcmdzKSA9PiB7XG4gIGNvbnN0IFtzdHIsIC4uLnJlc3RdID0gYXJncztcbiAgY29uc3QgY29uY2F0ZWRTdWJzdGluZ3MgPSByZXN0LmpvaW4oJycpO1xuICBjb25zdCBpdGVyID0gKGNvdW50LCBwb3NpdGlvbiwgY3Vyciwgc3Vic3RyaW5nKSA9PiB7XG4gICAgICBpZihjdXJyLmluZGV4T2Yoc3Vic3RyaW5nLCBwb3NpdGlvbikgPT09IC0xKSByZXR1cm4gY291bnQ7XG5cbiAgICAgIGxldCBuZXdQb3NpdGlvbiA9IGN1cnIuaW5kZXhPZihzdWJzdHJpbmcsIHBvc2l0aW9uKTtcbiAgICAgIHJldHVybiBpdGVyKCsrY291bnQsICsrbmV3UG9zaXRpb24sIGN1cnIsIHN1YnN0cmluZyk7XG4gIH1cblxuICByZXR1cm4gaXRlcigwLCAwLCBzdHIudG9Mb3dlckNhc2UoKSwgY29uY2F0ZWRTdWJzdGluZ3MudG9Mb3dlckNhc2UoKSlcblxuXG59XG5jb25zb2xlLmxvZygnZHNDb3VudCcpO1xudHJ5IHtcbiAgdGVzdChkc0NvdW50LCBbJ2FiX19fYWJfXycsICdhJywgJ2InXSwgMik7XG4gIHRlc3QoZHNDb3VudCwgWydfX19jZF9fX18nLCAnYycsICdkJ10sIDEpO1xuICB0ZXN0KGRzQ291bnQsIFsnZGVfX19fX19fJywgJ2QnLCAnZSddLCAxKTtcbiAgdGVzdChkc0NvdW50LCBbJzEyXzEyX18xMicsICcxJywgJzInXSwgMyk7XG4gIHRlc3QoZHNDb3VudCwgWydfYmFfX19fX18nLCAnYScsICdiJ10sIDApO1xuICB0ZXN0KGRzQ291bnQsIFsnX2FfX2JfX19fJywgJ2EnLCAnYiddLCAwKTtcbiAgdGVzdChkc0NvdW50LCBbJy1hYi3QsGItYWInLCAnYScsICdiJ10sIDIpO1xuICB0ZXN0KGRzQ291bnQsIFsnYUFhJywgJ2EnLCAnYSddLCAyKTtcbiAgY29uc29sZS5pbmZvKFwiQ29uZ3JhdHVsYXRpb25zISBBbGwgdGVzdHMgc3VjY2VzcyBwYXNzZWQuXCIpO1xufSBjYXRjaChlKSB7XG4gIGNvbnNvbGUuZXJyb3IoZSk7XG59XG5cbi8vINCf0YDQvtGB0YLQsNGPINGE0YPQvdC60YbQuNGPINGC0LXRgdGC0LjRgNC+0LLQsNC90LjRj1xuXG5mdW5jdGlvbiB0ZXN0KGNhbGwsIGFyZ3MsIGNvdW50LCBuKSB7XG4gIGxldCByID0gKGNhbGwuYXBwbHkobiwgYXJncykgPT09IGNvdW50KTtcbiAgY29uc29sZS5hc3NlcnQociwgYEZpbmRlZCBpdGVtcyBjb3VudDogJHtjb3VudH1gKTtcbiAgaWYgKCFyKSB0aHJvdyBcIlRlc3QgZmFpbGVkIVwiO1xufVxuXG4iLCIvL9CX0LDQtNCw0YfQsCAjMVxuY29uc3QgZ2V0U3Vic3RyaW5nID0gKHtzdHIsIHN1YlN0cjEsIHN1YlN0cjJ9KSA9PiB7XG4gIGlmIChzdHIgPT09ICcnKSByZXR1cm4gLTE7XG4gIGxldCBzdWJTdHJQb3NpdGlvbjEgPSBzdHIubGFzdEluZGV4T2Yoc3ViU3RyMSwgc3RyLmxlbmd0aCAtIDEpO1xuICBsZXQgc3ViU3RyUG9zaXRpb24yID0gc3RyLmxhc3RJbmRleE9mKHN1YlN0cjIsIHN0ci5sZW5ndGggLSAxKTtcblxuICByZXR1cm4gc3ViU3RyUG9zaXRpb24xICE9PSAtMSA/IHN1YlN0clBvc2l0aW9uMSA6XG4gICAgICAgICBzdWJTdHJQb3NpdGlvbjIgIT09IC0xID8gc3ViU3RyUG9zaXRpb24yIDpcbiAgICAgICAgIHN1YlN0clBvc2l0aW9uMSA9PT0gc3ViU3RyUG9zaXRpb24yID8gc3ViU3RyUG9zaXRpb24xIDogLTE7XG5cbn1cblxuZnVuY3Rpb24gZnVuYyhzLCBhLCBiKSB7XG5cbiAgaWYgKHMubWF0Y2goL14kLykpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICB2YXIgaSA9IHMubGVuZ3RoIC0xO1xuICB2YXIgYUluZGV4ID0gICAgIC0xO1xuICB2YXIgYkluZGV4ID0gICAgIC0xO1xuXG4gIHdoaWxlICgoYUluZGV4ID09IC0xKSAmJiAoYkluZGV4ID09IC0xKSAmJiAoaSA+IDApKSB7XG4gICAgaWYgKHMuc3Vic3RyaW5nKGksIGkgKzEpID09IGEpIHtcbiAgICAgIGFJbmRleCA9IGk7XG4gICAgfVxuICAgIGlmIChzLnN1YnN0cmluZyhpLCBpICsxKSA9PSBiKSB7XG4gICAgICBiSW5kZXggPSBpO1xuICAgIH1cbiAgICBpID0gaSAtIDE7XG4gIH1cbiAgaWYgKGFJbmRleCAhPSAtMSkge1xuICAgIGlmIChiSW5kZXggPT0gLTEpIHtcbiAgICAgIHJldHVybiBhSW5kZXg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIE1hdGgubWF4KGFJbmRleCwgYkluZGV4KTtcbiAgICB9XG4gIH1cblxuICBpZiAoYkluZGV4ICE9IC0xKSB7XG4gICAgcmV0dXJuIGJJbmRleDtcbiAgfVxuICBlbHNlIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbn1cblxuY29uc29sZS5sb2coXG4gICAgJ1JlZmFjdG9yaW5nIHRhc2sgMScsXG4gICAgZnVuYygnMTIzNDU1NjAnLCAnMCcsICcwJyksIGdldFN1YnN0cmluZyh7c3RyOiAnMTIzNDU1NjAnLCBzdWJTdHIxOiAnMCcsIHN1YlN0cjI6ICcwJ30pXG4pXG5cblxuLy/Ql9Cw0LTQsNGH0LAgMlxuY29uc3QgZHJhd1JhdGluZyA9ICh2b3RlLCByYW5nZSA9IFswLCAyMF0sIHN0YXJzID0gJ+KYheKYhuKYhuKYhuKYhicpID0+IHtcbiAgaWYgKHZvdGUgPj0gcmFuZ2VbMF0gJiYgdm90ZSA8PSByYW5nZVsxXSkgcmV0dXJuIHN0YXJzO1xuICByZXR1cm4gbmV3IEVycm9yKCfQp9GC0L4g0YLQviDQv9C+0YjQu9C+INC90LUg0YLQsNC6LCDQv9GA0L7QstC10YDRjNGC0LUg0LDRgNCz0YPQvNC10L3RgtGLJyk7XG59XG5cbi8vZnVuY3Rpb24gZHJhd1JhdGluZyh2b3RlKSB7XG4vLyAgaWYgKHZvdGUgPj0gMCAmJiB2b3RlIDw9IDIwKSB7XG4vLyAgICByZXR1cm4gJ+KYheKYhuKYhuKYhuKYhic7XG4vLyAgfVxuLy8gIGVsc2UgaWYgKHZvdGUgPiAyMCAmJiB2b3RlIDw9IDQwKSB7XG4vLyAgICByZXR1cm4gJ+KYheKYheKYhuKYhuKYhic7XG4vLyAgfVxuLy8gIGVsc2UgaWYgKHZvdGUgPiA0MCAmJiB2b3RlIDw9IDYwKSB7XG4vLyAgICByZXR1cm4gJ+KYheKYheKYheKYhuKYhic7XG4vLyAgfVxuLy8gIGVsc2UgaWYgKHZvdGUgPiA2MCAmJiB2b3RlIDw9IDgwKSB7XG4vLyAgICByZXR1cm4gJ+KYheKYheKYheKYheKYhic7XG4vLyAgfVxuLy8gIGVsc2UgaWYgKHZvdGUgPiA4MCAmJiB2b3RlIDw9IDEwMCkge1xuLy8gICAgcmV0dXJuICfimIXimIXimIXimIXimIUnO1xuLy8gIH1cbi8vfVxuXG4vLyDQn9GA0L7QstC10YDQutCwINGA0LDQsdC+0YLRiyDRgNC10LfRg9C70YzRgtCw0YLQsFxuY29uc29sZS5sb2coZHJhd1JhdGluZygwLCBbMCwgMjBdLCAn4piF4piG4piG4piG4piGJykgKTsgLy8g4piF4piG4piG4piG4piGXG5jb25zb2xlLmxvZyhkcmF3UmF0aW5nKDEsIFswLCAyMF0sICfimIXimIbimIbimIbimIYnKSApOyAvLyDimIXimIbimIbimIbimIZcbmNvbnNvbGUubG9nKGRyYXdSYXRpbmcoNTAsIFs0MCwgNjBdLCAn4piF4piF4piF4piG4piGJykpOyAvLyDimIXimIXimIXimIbimIZcbmNvbnNvbGUubG9nKGRyYXdSYXRpbmcoOTksIFs4MCwgMTAwXSwgJ+KYheKYheKYheKYheKYhScpKTsgLy8g4piF4piF4piF4piF4piFIl19
