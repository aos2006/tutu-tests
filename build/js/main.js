'use strict';

let compose = (f, g) => (str, ex) => f(g(str, ex));
let checkSequence = arr => {
  let pairs = 0;
  const iter = list => {
    if (!list.length) return pairs;
    return list.reduce((prev, item, i) => {
      if (`${prev}${item}` === '<>' || `${prev}${item}` === '[]' || `${prev}${item}` === '{}' || `${prev}${item}` === '()') {
        ++pairs;
        list.splice(--i, 2);
        iter(list);
      }
      return item;
    });
  };
  iter(arr);
  return pairs;
};
const sortBracketsStr = (str, excludedBrackets = []) => {
  let bracketsList = new Map([['(', { car: ')', cdr: '(' }], [')', { car: '(', cdr: ')' }], ['[', { car: ']', cdr: '[' }], [']', { car: '[', cdr: ']' }], ['{', { car: '}', cdr: '{' }], ['}', { car: '{', cdr: '}' }], ['<', { car: '>', cdr: '<' }], ['>', { car: '<', cdr: '>' }]]);
  excludedBrackets.length > 0 ? excludedBrackets.forEach(item => {
    bracketsList.delete(bracketsList.get(item).car);
    bracketsList.delete(item);
  }) : null;

  return str.split('').filter(char => bracketsList.has(char));
};

const checkSyntax = (str, excludedBrackets = []) => {
  let arrLen;
  let result = compose(arr => f => {
    arrLen = arr.length;
    return f(arr);
  }, sortBracketsStr)(str, excludedBrackets);
  let pairs = result(checkSequence);
  if (!arrLen) return 0;
  return arrLen / pairs === 2 ? 0 : 1;
};

console.log(checkSyntax("---()[][]----") === 0);
console.log(checkSyntax("(") === 1);
console.log(checkSyntax("[]{}{}((()))") === 0);
console.log(checkSyntax("before ( middle []) after ") === 0);
console.log(checkSyntax("( {} [] <> ){(((])))}") === 1);
console.log(checkSyntax(") (", ['(']) === 0);
console.log(checkSyntax("} {") === 1);
console.log(checkSyntax("} {", ['{']) === 0);
console.log(checkSyntax("<(   >)") === 1);
console.log(checkSyntax("<(   >)", ['(']) === 0);
console.log(checkSyntax("(  [  <[]>  ()  ]  <>  )") === 0);
console.log(checkSyntax("(  [  <>  ()  ]  <>  )", ['<', '[', '(']) === 0);
console.log(checkSyntax("   (      [)") === 1);
console.log(checkSyntax("   (      [)", ['[']) === 0);
'use strict';

let dsCount = (...args) => {
  const [str, ...rest] = args;
  const concatedSubstings = rest.join('');
  const iter = (count, position, curr, substring) => {
    if (curr.indexOf(substring, position) === -1) return count;

    let newPosition = curr.indexOf(substring, position);
    return iter(++count, ++newPosition, curr, substring);
  };

  return iter(0, 0, str.toLowerCase(), concatedSubstings.toLowerCase());
};

try {
  test(dsCount, ['ab___ab__', 'a', 'b'], 2);
  test(dsCount, ['___cd____', 'c', 'd'], 1);
  test(dsCount, ['de_______', 'd', 'e'], 1);
  test(dsCount, ['12_12__12', '1', '2'], 3);
  test(dsCount, ['_ba______', 'a', 'b'], 0);
  test(dsCount, ['_a__b____', 'a', 'b'], 0);
  test(dsCount, ['-ab-аb-ab', 'a', 'b'], 2);
  test(dsCount, ['aAa', 'a', 'a'], 2);
  console.info("Congratulations! All tests success passed.");
} catch (e) {
  console.error(e);
}

// Простая функция тестирования

function test(call, args, count, n) {
  let r = call.apply(n, args) === count;
  console.assert(r, `Finded items count: ${count}`);
  if (!r) throw "Test failed!";
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrU3ludGF4LmpzIiwiZHNDb3VudC5qcyJdLCJuYW1lcyI6WyJjb21wb3NlIiwiZiIsImciLCJzdHIiLCJleCIsImNoZWNrU2VxdWVuY2UiLCJhcnIiLCJwYWlycyIsIml0ZXIiLCJsaXN0IiwibGVuZ3RoIiwicmVkdWNlIiwicHJldiIsIml0ZW0iLCJpIiwic3BsaWNlIiwic29ydEJyYWNrZXRzU3RyIiwiZXhjbHVkZWRCcmFja2V0cyIsImJyYWNrZXRzTGlzdCIsIk1hcCIsImNhciIsImNkciIsImZvckVhY2giLCJkZWxldGUiLCJnZXQiLCJzcGxpdCIsImZpbHRlciIsImNoYXIiLCJoYXMiLCJjaGVja1N5bnRheCIsImFyckxlbiIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJkc0NvdW50IiwiYXJncyIsInJlc3QiLCJjb25jYXRlZFN1YnN0aW5ncyIsImpvaW4iLCJjb3VudCIsInBvc2l0aW9uIiwiY3VyciIsInN1YnN0cmluZyIsImluZGV4T2YiLCJuZXdQb3NpdGlvbiIsInRvTG93ZXJDYXNlIiwidGVzdCIsImluZm8iLCJlIiwiZXJyb3IiLCJjYWxsIiwibiIsInIiLCJhcHBseSIsImFzc2VydCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsVUFBVSxDQUFDQyxDQUFELEVBQUlDLENBQUosS0FBVSxDQUFDQyxHQUFELEVBQU1DLEVBQU4sS0FBYUgsRUFBRUMsRUFBRUMsR0FBRixFQUFPQyxFQUFQLENBQUYsQ0FBckM7QUFDQSxJQUFJQyxnQkFBaUJDLEdBQUQsSUFBUztBQUN6QixNQUFJQyxRQUFRLENBQVo7QUFDQSxRQUFNQyxPQUFRQyxJQUFELElBQVU7QUFDckIsUUFBSSxDQUFDQSxLQUFLQyxNQUFWLEVBQWtCLE9BQU9ILEtBQVA7QUFDbEIsV0FBT0UsS0FBS0UsTUFBTCxDQUFZLENBQUNDLElBQUQsRUFBT0MsSUFBUCxFQUFhQyxDQUFiLEtBQW1CO0FBQ3BDLFVBQ0ssR0FBRUYsSUFBSyxHQUFFQyxJQUFLLEVBQWYsS0FB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LEVBQWlDWSxDQUFqQyxFQUFvQztBQUNsQyxNQUFJQyxJQUFLRixLQUFLRyxLQUFMLENBQVdGLENBQVgsRUFBY2hCLElBQWQsTUFBd0JJLEtBQWpDO0FBQ0FQLFVBQVFzQixNQUFSLENBQWVGLENBQWYsRUFBbUIsdUJBQXNCYixLQUFNLEVBQS9DO0FBQ0EsTUFBSSxDQUFDYSxDQUFMLEVBQVEsTUFBTSxjQUFOO0FBQ1QiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmxldCBjb21wb3NlID0gKGYsIGcpID0+IChzdHIsIGV4KSA9PiBmKGcoc3RyLCBleCkpO1xubGV0IGNoZWNrU2VxdWVuY2UgPSAoYXJyKSA9PiB7XG4gICAgbGV0IHBhaXJzID0gMDtcbiAgICBjb25zdCBpdGVyID0gKGxpc3QpID0+IHtcbiAgICAgIGlmICghbGlzdC5sZW5ndGgpIHJldHVybiBwYWlycztcbiAgICAgIHJldHVybiBsaXN0LnJlZHVjZSgocHJldiwgaXRlbSwgaSkgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICBgJHtwcmV2fSR7aXRlbX1gID09PSAnPD4nIHx8XG4gICAgICAgICAgICBgJHtwcmV2fSR7aXRlbX1gID09PSAnW10nIHx8XG4gICAgICAgICAgICBgJHtwcmV2fSR7aXRlbX1gID09PSAne30nIHx8XG4gICAgICAgICAgICBgJHtwcmV2fSR7aXRlbX1gID09PSAnKCknXG4gICAgICAgICkge1xuICAgICAgICAgICsrcGFpcnM7XG4gICAgICAgICAgbGlzdC5zcGxpY2UoLS1pLCAyKTtcbiAgICAgICAgICBpdGVyKGxpc3QpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGl0ZXIoYXJyKTtcbiAgICByZXR1cm4gcGFpcnM7XG59XG5jb25zdCBzb3J0QnJhY2tldHNTdHIgPSAoc3RyLCBleGNsdWRlZEJyYWNrZXRzID0gW10pID0+IHtcbiAgbGV0IGJyYWNrZXRzTGlzdCA9IG5ldyBNYXAoXG4gICAgICBbXG4gICAgICAgIFsnKCcsIHtjYXI6ICcpJywgY2RyOiAnKCd9XSxcbiAgICAgICAgWycpJywge2NhcjogJygnLCBjZHI6ICcpJ31dLFxuICAgICAgICBbJ1snLCB7Y2FyOiAnXScsIGNkcjogJ1snfV0sXG4gICAgICAgIFsnXScsIHtjYXI6ICdbJywgY2RyOiAnXSd9XSxcbiAgICAgICAgWyd7Jywge2NhcjogJ30nLCBjZHI6ICd7J31dLFxuICAgICAgICBbJ30nLCB7Y2FyOiAneycsIGNkcjogJ30nfV0sXG4gICAgICAgIFsnPCcsIHtjYXI6ICc+JywgY2RyOiAnPCd9XSxcbiAgICAgICAgWyc+Jywge2NhcjogJzwnLCBjZHI6ICc+J31dLFxuICAgICAgXVxuICApO1xuICBleGNsdWRlZEJyYWNrZXRzLmxlbmd0aCA+IDAgPyBleGNsdWRlZEJyYWNrZXRzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgYnJhY2tldHNMaXN0LmRlbGV0ZShicmFja2V0c0xpc3QuZ2V0KGl0ZW0pLmNhcik7XG4gICAgYnJhY2tldHNMaXN0LmRlbGV0ZShpdGVtKTtcbiAgfSkgOiBudWxsO1xuXG4gIHJldHVybiBzdHIuc3BsaXQoJycpLmZpbHRlcihjaGFyID0+IGJyYWNrZXRzTGlzdC5oYXMoY2hhcikpO1xufVxuXG5jb25zdCBjaGVja1N5bnRheCA9IChzdHIsIGV4Y2x1ZGVkQnJhY2tldHMgPSBbXSkgPT4ge1xuICBsZXQgYXJyTGVuO1xuICBsZXQgcmVzdWx0ID0gY29tcG9zZShhcnIgPT4gKGYpID0+IHtcbiAgICBhcnJMZW4gPSBhcnIubGVuZ3RoXG4gICAgcmV0dXJuIGYoYXJyKTtcbiAgfSwgc29ydEJyYWNrZXRzU3RyKShzdHIsIGV4Y2x1ZGVkQnJhY2tldHMpO1xuICBsZXQgcGFpcnMgPSByZXN1bHQoY2hlY2tTZXF1ZW5jZSk7XG4gIGlmKCFhcnJMZW4pIHJldHVybiAwO1xuICByZXR1cm4gYXJyTGVuIC8gcGFpcnMgPT09IDIgPyAwIDogMTtcbn1cblxuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIi0tLSgpW11bXS0tLS1cIikgPT09IDApO1xuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIihcIikgPT09IDEpO1xuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIltde317fSgoKCkpKVwiKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiYmVmb3JlICggbWlkZGxlIFtdKSBhZnRlciBcIikgPT09IDApO1xuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIigge30gW10gPD4gKXsoKChdKSkpfVwiKSA9PT0gMSk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiKSAoXCIsIFsnKCddKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwifSB7XCIpID09PSAxKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCJ9IHtcIiwgWyd7J10pID09PSAwKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCI8KCAgID4pXCIpID09PSAxKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCI8KCAgID4pXCIsIFsnKCddKSA9PT0gMCk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiKCAgWyAgPFtdPiAgKCkgIF0gIDw+ICApXCIpID09PSAwKTtcbmNvbnNvbGUubG9nIChjaGVja1N5bnRheCAoXCIoICBbICA8PiAgKCkgIF0gIDw+ICApXCIsIFsnPCcsICdbJywgJygnXSkgPT09IDApO1xuY29uc29sZS5sb2cgKGNoZWNrU3ludGF4IChcIiAgICggICAgICBbKVwiKSA9PT0gMSk7XG5jb25zb2xlLmxvZyAoY2hlY2tTeW50YXggKFwiICAgKCAgICAgIFspXCIsIFsnWyddKSA9PT0gMCk7XG5cbiIsIid1c2Ugc3RyaWN0JztcbmxldCBkc0NvdW50ID0gKC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgW3N0ciwgLi4ucmVzdF0gPSBhcmdzO1xuICBjb25zdCBjb25jYXRlZFN1YnN0aW5ncyA9IHJlc3Quam9pbignJyk7XG4gIGNvbnN0IGl0ZXIgPSAoY291bnQsIHBvc2l0aW9uLCBjdXJyLCBzdWJzdHJpbmcpID0+IHtcbiAgICAgIGlmKGN1cnIuaW5kZXhPZihzdWJzdHJpbmcsIHBvc2l0aW9uKSA9PT0gLTEpIHJldHVybiBjb3VudDtcblxuICAgICAgbGV0IG5ld1Bvc2l0aW9uID0gY3Vyci5pbmRleE9mKHN1YnN0cmluZywgcG9zaXRpb24pO1xuICAgICAgcmV0dXJuIGl0ZXIoKytjb3VudCwgKytuZXdQb3NpdGlvbiwgY3Vyciwgc3Vic3RyaW5nKTtcbiAgfVxuXG4gIHJldHVybiBpdGVyKDAsIDAsIHN0ci50b0xvd2VyQ2FzZSgpLCBjb25jYXRlZFN1YnN0aW5ncy50b0xvd2VyQ2FzZSgpKVxuXG5cbn1cblxudHJ5IHtcbiAgdGVzdChkc0NvdW50LCBbJ2FiX19fYWJfXycsICdhJywgJ2InXSwgMik7XG4gIHRlc3QoZHNDb3VudCwgWydfX19jZF9fX18nLCAnYycsICdkJ10sIDEpO1xuICB0ZXN0KGRzQ291bnQsIFsnZGVfX19fX19fJywgJ2QnLCAnZSddLCAxKTtcbiAgdGVzdChkc0NvdW50LCBbJzEyXzEyX18xMicsICcxJywgJzInXSwgMyk7XG4gIHRlc3QoZHNDb3VudCwgWydfYmFfX19fX18nLCAnYScsICdiJ10sIDApO1xuICB0ZXN0KGRzQ291bnQsIFsnX2FfX2JfX19fJywgJ2EnLCAnYiddLCAwKTtcbiAgdGVzdChkc0NvdW50LCBbJy1hYi3QsGItYWInLCAnYScsICdiJ10sIDIpO1xuICB0ZXN0KGRzQ291bnQsIFsnYUFhJywgJ2EnLCAnYSddLCAyKTtcbiAgY29uc29sZS5pbmZvKFwiQ29uZ3JhdHVsYXRpb25zISBBbGwgdGVzdHMgc3VjY2VzcyBwYXNzZWQuXCIpO1xufSBjYXRjaChlKSB7XG4gIGNvbnNvbGUuZXJyb3IoZSk7XG59XG5cbi8vINCf0YDQvtGB0YLQsNGPINGE0YPQvdC60YbQuNGPINGC0LXRgdGC0LjRgNC+0LLQsNC90LjRj1xuXG5mdW5jdGlvbiB0ZXN0KGNhbGwsIGFyZ3MsIGNvdW50LCBuKSB7XG4gIGxldCByID0gKGNhbGwuYXBwbHkobiwgYXJncykgPT09IGNvdW50KTtcbiAgY29uc29sZS5hc3NlcnQociwgYEZpbmRlZCBpdGVtcyBjb3VudDogJHtjb3VudH1gKTtcbiAgaWYgKCFyKSB0aHJvdyBcIlRlc3QgZmFpbGVkIVwiO1xufVxuXG4iXX0=
